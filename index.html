<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>CPShareTXT - Fast, Private Text & File Sharing</title>

  <!-- Primary meta -->
  <meta name="description" content="CP Share TXT — Paste text or upload files (up to 25MB) and get a private short link that auto-deletes after 5 minutes. Free, no sign-up. Colombo, Sri Lanka." />
  <meta name="author" content="Kavizz — Team Alpha Software Solutions" />
  <meta name="keywords" content="pastebin, text share, temporary links, file sharing, ephemeral links, private paste, Colombo, Sri Lanka, CPShareTXT" />
  <meta name="robots" content="index, follow, max-image-preview:large" />

  <!-- Canonical & alternate language (adjust hrefs if you host language variants) -->
  <link rel="canonical" href="https://cpsharetxt.com/" />
  <!-- Example hreflang: uncomment/add if you serve other languages -->
  <!-- <link rel="alternate" href="https://cpsharetxt.com/" hreflang="en" /> -->

  <!-- Resource Hints: speed up critical connections -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://assets10.lottiefiles.com" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Preload critical CSS or fonts (adjust URLs to match your assets) -->
  <!-- <link rel="preload" href="/css/main.css" as="style"> -->
  <!-- <link rel="preload" href="/fonts/Inter-Variable.woff2" as="font" type="font/woff2" crossorigin> -->

  <!-- Favicons & PWA manifest -->
  <link rel="icon" href="/icons/icontxt.webp" type="image/webp">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#06b6d4">

  <!-- Social / Open Graph -->
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CP Share TXT — Fast, Private Text & File Sharing" />
  <meta property="og:description" content="Paste text or upload files and get a private short link that auto-deletes after 5 minutes. Free, no sign-up." />
  <meta property="og:url" content="https://cpsharetxt.com/" />
  <!-- Replace with properly sized share image on your server (1200x630 recommended) -->
  <meta property="og:image" content="https://cpsharetxt.com/og-image.png" />
  <meta property="og:image:alt" content="CP Share TXT — Fast & Private ephemeral text + file sharing" />
  <meta property="og:site_name" content="CP Share TXT" />

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@YourTwitterHandle" />
  <meta name="twitter:creator" content="@YourTwitterHandle" />
  <meta name="twitter:title" content="CP Share TXT — Fast, Private Text & File Sharing" />
  <meta name="twitter:description" content="Paste text or upload files and get a private short link that auto-deletes after 5 minutes. Free, no sign-up." />
  <meta name="twitter:image" content="https://cpsharetxt.com/og-image.png" />

  <!-- Accessibility / Referrer policy -->
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- Sitemap (advise search engines where to crawl) -->
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />

  <!-- Structured Data - JSON-LD (Organization, WebSite with SearchAction, WebPage) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "Organization",
        "@id": "https://cpsharetxt.com/#organization",
        "name": "CP Share TXT",
        "url": "https://cpsharetxt.com/",
        "logo": "https://cpsharetxt.com/icontxt.webp",
        "sameAs": [
          "https://facebook.com/your-page",
          "https://twitter.com/your-handle",
          "https://github.com/your-profile"
        ]
      },
      {
        "@type": "WebSite",
        "@id": "https://cpsharetxt.com/#website",
        "url": "https://cpsharetxt.com/",
        "name": "CP Share TXT",
        "publisher": { "@id": "https://cpsharetxt.com/#organization" },
        "potentialAction": {
          "@type": "SearchAction",
          "target": "https://cpsharetxt.com/?q={search_term_string}",
          "query-input": "required name=search_term_string"
        }
      },
      {
        "@type": "WebPage",
        "@id": "https://cpsharetxt.com/#webpage",
        "url": "https://cpsharetxt.com/",
        "name": "CP Share TXT — Fast, Private Text & File Sharing",
        "description": "Paste text or upload files and get a private short link that auto-deletes after 5 minutes. Free, no sign-up.",
        "inLanguage": "en-US",
        "isPartOf": { "@id": "https://cpsharetxt.com/#website" }
      },
      {
        "@type": "BreadcrumbList",
        "itemListElement": [
          { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://cpsharetxt.com/" },
          { "@type": "ListItem", "position": 2, "name": "Saved Data", "item": "https://cpsharetxt.com/display_data.html" }
        ]
      }
    ]
  }
  </script>

  <!-- Styles & Frameworks (keep your existing includes) -->
  <!-- Bootstrap 5 + icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- AOS + Lottie + SweetAlert2 -->
  <link href="https://unpkg.com/aos@2.3.4/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/@lottiefiles/lottie-player@1.5.7/dist/lottie-player.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    :root{
      --accent: #06b6d4;
      --accent-2: #0891b2;
      --muted: #9ca3af;
      --bg-dark: #071a2b;
      --bg-light: #f8fafc;
      --card-radius: 1rem;
      --focus: rgba(6,182,212,0.14);
      --glass-dark: rgba(255,255,255,0.03);
      --glass-light: rgba(2,6,23,0.04);
      --max-width: 1100px;
    }

    /* ---------- Base ---------- */
    html,body{height:100%;}
    body{
      margin:0;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#e6eef6;
      background:
        radial-gradient(1000px 600px at 10% 10%, rgba(6,182,212,0.06), transparent),
        radial-gradient(800px 500px at 90% 90%, rgba(8,145,178,0.04), transparent),
        linear-gradient(180deg, var(--bg-dark) 0%, #041023 0%);
      -webkit-font-smoothing:antialiased;
      -webkit-text-size-adjust:100%;
    }

    /* Light theme */
    body.light{
      color:#081225;
      background: linear-gradient(180deg, var(--bg-light) 0%, #eef2ff 100%);
    }

    .app-container { max-width: var(--max-width); margin:0 auto; padding:1rem; }

    /* Card */
    .card-glass{
      border-radius: var(--card-radius);
      border:1px solid rgba(255,255,255,0.04);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      backdrop-filter: blur(8px);
      padding: 1rem;
    }
    body.light .card-glass{
      background: linear-gradient(180deg,#fff,#fbfdff);
      border:1px solid var(--glass-light);
      box-shadow: 0 8px 30px rgba(11,18,32,0.04);
    }

    header { padding: .75rem 0; }
    .brand-title { font-weight:800; letter-spacing:-0.3px; }
    .brand-sub { font-size:.78rem; opacity:.9; }

    /* Responsive headings */
    .hero-title { font-size: clamp(1.4rem, 4.5vw, 2.4rem); font-weight:800; line-height:1.02; }

    /* Form controls */
    .form-control, .form-select, textarea {
      border-radius: .65rem;
      padding: .7rem .9rem;
      background: transparent;
      color: inherit;
      border: 1px solid rgba(255,255,255,0.06);
    }
    body.light .form-control, body.light .form-select, body.light textarea {
      border: 1px solid rgba(2,6,23,0.08);
      color: #081225;
      background: linear-gradient(180deg,#fff,#fbfdff);
    }

    /* Placeholders */
    ::placeholder { color: rgba(230,238,246,0.6); opacity:1; }
    body.light ::placeholder { color: rgba(8,18,36,0.45); }

    /* Select caret */
    .select-wrap { position: relative; }
    .select-wrap .bi { position:absolute; right:12px; top:50%; transform:translateY(-50%); pointer-events:none; color: rgba(255,255,255,0.6); }
    body.light .select-wrap .bi { color: rgba(8,18,36,0.45); }

    /* Drag area */
    .drag-area {
      border-radius:.75rem;
      border:2px dashed rgba(255,255,255,0.06);
      padding:1rem;
      text-align:center;
      cursor:pointer;
      transition: all .16s ease;
      min-height:90px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:.35rem;
      background: transparent;
    }
    .drag-area.dragover { transform: translateY(-6px); box-shadow: 0 20px 50px rgba(6,182,212,0.06); border-color: rgba(6,182,212,0.45); }
    body.light .drag-area { border: 2px dashed rgba(2,6,23,0.06); }

    .thumb { max-height:160px; display:block; margin:.5rem auto; border-radius:.5rem; }

    /* Buttons */
    .btn-accent { background: var(--accent); color:#042028; font-weight:700; border:none; }
    .btn-outline-custom { border:1px solid rgba(255,255,255,0.06); color:inherit; }
    body.light .btn-outline-custom { border:1px solid rgba(2,6,23,0.08); }

    /* Responsive utilities */
    @media (max-width: 576px){
      .hero-grid { grid-template-columns: 1fr !important; }
      .brand-sub { display:none; }
    }

    /* Focus (accessibility) */
    :focus { outline: 4px solid var(--focus); outline-offset: 2px; border-radius:.5rem; }

    /* Dark-mode form visibility overrides */
    body:not(.light) input, body:not(.light) textarea, body:not(.light) select, body:not(.light) .form-control, body:not(.light) .form-select {
      background: rgba(255,255,255,0.03) !important;
      color: #e6eef6 !important;
      border-color: rgba(255,255,255,0.08) !important;
    }
    body:not(.light) ::placeholder { color: rgba(230,238,246,0.88) !important; opacity:1 !important; }
    body:not(.light) select option { background:#061224 !important; color:#e6eef6 !important; }

    /* Small helpers */
    .muted { color: rgba(230,238,246,0.64); }
    body.light .muted { color: #5b6b78; }

    /* Toast fallback */
    #toast { position: fixed; right: 20px; bottom: 30px; z-index:60; display:none; }
  </style>
</head>
<body>
  <div class="app-container">

    <!-- NAV -->
    <!-- NAV / HEADER (user-provided header) -->
    <header class="d-flex align-items-center justify-content-between">
      <a href="/" class="d-flex align-items-center gap-3 text-decoration-none">
        <div style="width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#06b6d4,#0891b2);display:flex;align-items:center;justify-content:center;">
          <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_jtbfg2nb.json" background="transparent" speed="1" style="width:40px;height:40px" loop autoplay></lottie-player>
        </div>
        <div>
          <div class="brand-title">CP Share TXT</div>
          <div class="brand-sub muted">Fast • Private • Free</div>
        </div>
      </a>

      <nav class="d-flex align-items-center gap-2">
        <div class="d-none d-sm-inline nav-cta muted">Free • </div>
        <a href="display_data.html" class="text-decoration-none small px-2 py-1 rounded-2 muted">Saved</a>
        <a href="feedback_form.html" class="text-decoration-none small px-2 py-1 rounded-2 muted">Feedback</a>
        <a href="admin_panel.php" class="text-decoration-none small px-2 py-1 rounded-2 muted" style="background: rgba(0,0,0,0.04);">Admin</a>

        <button id="themeToggle" class="btn btn-sm btn-outline-custom ms-2" aria-label="Toggle theme" title="Toggle light/dark">
          <i id="themeIcon" class="bi bi-moon-fill"></i>
        </button>
      </nav>
    </header>

    <!-- HERO + FORM -->
    <main class="row gx-4 gy-4 align-items-start mt-3">

      <!-- Left: Info -->
      <section class="col-12 col-lg-7">
        <div class="card-glass p-3 p-lg-4" data-aos="fade-up">
          <div class="d-flex gap-3">
            <div style="width:88px;height:88px;border-radius:14px;background:linear-gradient(135deg,#06b6d4,#0891b2);display:flex;align-items:center;justify-content:center;">
              <lottie-player src="https://assets7.lottiefiles.com/packages/lf20_u4yrau.json" background="transparent" speed="1" style="width:72px;height:72px" loop autoplay></lottie-player>
            </div>

            <div class="flex-grow-1">
              <h1 class="hero-title">Share text or files instantly - private & ephemeral</h1>
              <p class="muted mt-2 mb-3">Paste long text or drop a file (up to <strong>25 MB</strong>). We generate a short link that auto-deletes after <strong>5 minutes</strong>. No sign-up required.</p>

              <div class="row row-cols-1 row-cols-sm-3 g-2 mb-3">
                <div class="col"><div class="p-2 rounded-3" style="background: rgba(255,255,255,0.03)"><div class="h5 mb-0">5 min</div><div class="muted small mt-1">Auto delete</div></div></div>
                <div class="col"><div class="p-2 rounded-3" style="background: rgba(255,255,255,0.03)"><div class="h5 mb-0">Any file</div><div class="muted small mt-1">Up to 25 MB</div></div></div>
                <div class="col"><div class="p-2 rounded-3" style="background: rgba(255,255,255,0.03)"><div class="h5 mb-0">Copy</div><div class="muted small mt-1">Instant link</div></div></div>
              </div>

              <div class="d-flex gap-2">
                <a class="btn btn-accent btn-lg me-2" href="#formSection">Start Sharing</a>
                <a class="btn btn-outline-custom btn-lg" href="display_data.html">View saved</a>
              </div>
            </div>
          </div>
        </div>

        <div class="mt-3 d-grid gap-3">
          <div class="card-glass p-3" data-aos="fade-up" data-aos-delay="120">
            <h6 class="mb-2">How to use</h6>
            <ol class="small muted mb-0">
              <li>Choose <strong>Text</strong> or <strong>File</strong>.</li>
              <li>Paste text or drag & drop a file (max 25 MB).</li>
              <li>Click <strong>Share</strong> and copy the link.</li>
              <li>Link auto-deletes after 5 minutes.</li>
            </ol>
          </div>

          <div class="card-glass p-3" data-aos="fade-up" data-aos-delay="160">
            <h6 class="mb-2">Privacy tips</h6>
            <ul class="small muted mb-0">
              <li>Don't upload highly sensitive personal data.</li>
              <li>Use for quick code snippets, notes, or one-time file transfers.</li>
            </ul>
          </div>
        </div>
      </section>

      <!-- Right: Form -->
      <aside id="formSection" class="col-12 col-lg-5">
        <div class="card-glass p-3 p-md-4" data-aos="fade-left">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
              <h3 class="mb-0">Share Text or File</h3>
              <div class="small muted">Private • Free • Colombo</div>
            </div>
            <div class="small muted">Auto-delete <strong>5m</strong></div>
          </div>

          <form id="userForm" enctype="multipart/form-data" method="POST" novalidate>
            <div class="mb-2">
              <label for="username" class="form-label visually-hidden">Display name</label>
              <input id="username" name="username" type="text" placeholder="Display name (optional)" class="form-control" aria-label="Display name (optional)">
            </div>

            <div class="mb-2">
              <label for="inputType" class="form-label visually-hidden">Input Type</label>
              <div class="select-wrap">
                <select id="inputType" name="inputType" class="form-select" aria-label="Choose input type">
                  <option value="text">Text</option>
                  <option value="file">File</option>
                </select>
                <i class="bi bi-caret-down-fill"></i>
              </div>
            </div>

            <!-- Text -->
            <div id="textInputSection" class="mb-2">
              <label for="userText" class="form-label visually-hidden">Text</label>
              <textarea id="userText" name="userText" rows="8" maxlength="10000" placeholder="Paste or type your text here (max 10,000 chars)" class="form-control"></textarea>
              <div class="d-flex justify-content-between small muted mt-2">
                <div id="charCount">0 / 10000</div>
                <div>Supports plain text & code</div>
              </div>
            </div>

            <!-- File -->
            <div id="fileInputSection" class="mb-2 d-none">
              <div id="dragDropArea" class="drag-area" tabindex="0" role="button" aria-label="Drag and drop file area">
                <div><i class="bi bi-cloud-arrow-up" style="font-size:1.25rem"></i></div>
                <div id="dragText" class="muted small">Drag & drop file here or click to upload</div>
                <div id="dragHint" class="muted x-small">Any file type • Max 25 MB</div>

                <div id="dragPreview" class="mt-2 visually-hidden text-start w-100">
                  <div id="dragPreviewName" class="text-sm text-muted mb-1"></div>
                  <img id="dragPreviewThumb" src="" alt="" class="thumb visually-hidden" />
                </div>
              </div>

              <input id="userFile" name="userFile" type="file" class="form-control visually-hidden" aria-hidden="true" />
            </div>

            <div class="mt-3 d-flex gap-2">
              <button type="submit" class="btn btn-accent flex-fill" aria-label="Share">Share <i class="bi bi-link-45deg ms-2"></i></button>
              <button type="button" id="clearBtn" class="btn btn-outline-custom">Clear</button>
            </div>

            <div class="mt-3 small muted">Privacy: For quick, ephemeral sharing - do not submit sensitive personal data.</div>
          </form>

          <div class="mt-3 small muted">Built by  • <span id="currentYear"></span></div>
        </div>
      </aside>
    </main>

    <div class="text-center muted small mt-4">Terms • Privacy • Contact</div>

    <footer class="mt-4 py-4 text-center">
      <div class="card-glass d-inline-block p-3 rounded-3">
        <div class="small muted mb-1">Made with Kavizz - CP Share TXT</div>
        <div class="small muted">© <span id="footerYear"></span> • Team Alpha Software Solutions - Kavizz</div>
      </div>
    </footer>
  </div>

  <!-- Toast fallback -->
  <div id="toast" class="max-w-xs w-full bg-emerald-500 text-white px-4 py-3 rounded-lg shadow-lg mr-4 mb-4">
    <div id="toastMessage" class="text-sm font-medium">Saved — link copied.</div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/aos@2.3.4/dist/aos.js"></script>
  <script>AOS.init({ duration:700, once:true, disable:'phone' });</script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  (function(){
    /* Elements */
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const body = document.body;
    const saved = localStorage.getItem('cp_theme');
    const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
    const isLight = saved ? saved === 'light' : prefersLight;

    function applyTheme(light){
      if (light){
        body.classList.add('light');
        themeIcon.className = 'bi bi-sun-fill';
        themeToggle.classList.remove('btn-outline-custom'); themeToggle.classList.add('btn-outline-light');
      } else {
        body.classList.remove('light');
        themeIcon.className = 'bi bi-moon-fill';
        themeToggle.classList.remove('btn-outline-light'); themeToggle.classList.add('btn-outline-custom');
      }
    }
    applyTheme(isLight);
    themeToggle.addEventListener('click', ()=>{
      const nowLight = !body.classList.contains('light');
      applyTheme(nowLight);
      localStorage.setItem('cp_theme', nowLight ? 'light' : 'dark');
    });

    /* Dynamic year + credit */
    document.getElementById('currentYear').textContent = new Date().getFullYear();
    document.getElementById('footerYear').textContent = new Date().getFullYear();
    const prodEl = document.getElementById('productCredit');
    if (prodEl) prodEl.textContent = 'Team Alpha Software Solutions - Kavizz';

    /* Form elements */
    const form = document.getElementById('userForm');
    const inputType = document.getElementById('inputType');
    const textSection = document.getElementById('textInputSection');
    const fileSection = document.getElementById('fileInputSection');
    const userText = document.getElementById('userText');
    const charCount = document.getElementById('charCount');
    const userFile = document.getElementById('userFile');
    const dragDropArea = document.getElementById('dragDropArea');
    const dragText = document.getElementById('dragText');
    const dragHint = document.getElementById('dragHint');
    const dragPreview = document.getElementById('dragPreview');
    const dragPreviewName = document.getElementById('dragPreviewName');
    const dragPreviewThumb = document.getElementById('dragPreviewThumb');
    const filePreview = document.getElementById('filePreview'); // not used but kept for compatibility
    const clearBtn = document.getElementById('clearBtn');
    const maxFileSize = 25 * 1024 * 1024; // 25MB

    /* Update form type UI (and auto-open picker when switching to file) */
    async function updateFormAction(openPicker=true){
      if (inputType.value === 'text'){
        form.action = 'save_text.php';
        textSection.classList.remove('d-none');
        fileSection.classList.add('d-none');
        userFile.value = '';
        resetDragPreview();
        charCount.textContent = `${userText.value.length} / 10000`;
      } else {
        form.action = 'save_file.php';
        textSection.classList.add('d-none');
        fileSection.classList.remove('d-none');
        userText.value = '';
        charCount.textContent = '0 / 10000';
        if (openPicker){
          // small delay so UI updates before picker appears
          await new Promise(r=>setTimeout(r,120));
          try { userFile.click(); } catch(e){/*ignored*/ }
        }
      }
    }
    inputType.addEventListener('change', ()=> updateFormAction(true));
    updateFormAction(false);

    /* Char counter */
    userText.addEventListener('input', ()=> charCount.textContent = `${userText.value.length} / 10000`);

    /* Drag & drop handling (keyboard & touch friendly) */
    if (dragDropArea){
      ['dragenter','dragover'].forEach(evt => dragDropArea.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); dragDropArea.classList.add('dragover'); }));
      ['dragleave','drop','dragend'].forEach(evt => dragDropArea.addEventListener(evt, (e)=>{ e.preventDefault(); e.stopPropagation(); dragDropArea.classList.remove('dragover'); }));

      dragDropArea.addEventListener('click', ()=> userFile.click());
      dragDropArea.addEventListener('keypress', (e)=>{ if (e.key === 'Enter' || e.key === ' ') userFile.click(); });

      dragDropArea.addEventListener('drop', (e)=>{
        const files = e.dataTransfer.files;
        if (!files || !files.length) return;
        const file = files[0];
        if (file.size > maxFileSize){ Swal.fire({ icon:'error', title:'File too large', text:'Max file size is 25 MB.'}); return; }
        userFile.files = files; // populate the native input
        showFilePreview(file);
      });
    }

    /* Native picker change */
    userFile.addEventListener('change', function(){
      if (!this.files || !this.files.length) { resetDragPreview(); return; }
      const file = this.files[0];
      if (file.size > maxFileSize){ Swal.fire({ icon:'error', title:'File too large', text:'Max file size is 25 MB.' }); this.value=''; resetDragPreview(); return; }
      showFilePreview(file);
    });

    /* Show preview inside drag area */
    function showFilePreview(file){
      if (!file) return;
      dragPreview.classList.remove('visually-hidden');
      dragPreview.classList.remove('hidden');
      dragPreviewName.textContent = `${file.name} — ${Math.round(file.size/1024)} KB`;
      dragText.textContent = 'File selected';
      dragHint.textContent = 'Tap area to change or drag another file';
      if (file.type.startsWith('image/')){
        dragPreviewThumb.src = URL.createObjectURL(file);
        dragPreviewThumb.onload = ()=> { URL.revokeObjectURL(dragPreviewThumb.src); dragPreviewThumb.classList.remove('visually-hidden'); dragPreviewThumb.classList.remove('hidden'); };
      } else {
        dragPreviewThumb.src = '';
        dragPreviewThumb.classList.add('visually-hidden');
        dragPreviewThumb.classList.add('hidden');
      }
    }

    function resetDragPreview(){
      dragPreview.classList.add('visually-hidden');
      dragPreview.classList.add('hidden');
      dragPreviewName.textContent = '';
      dragPreviewThumb.src = '';
      dragPreviewThumb.classList.add('visually-hidden');
      dragPreviewThumb.classList.add('hidden');
      dragText.textContent = 'Drag & drop file here or click to upload';
      dragHint.textContent = 'Any file type • Max 25 MB';
      userFile.value = '';
    }

    /* Clear button */
    clearBtn.addEventListener('click', ()=>{
      form.reset();
      updateFormAction(false);
      resetDragPreview();
      charCount.textContent = '0 / 10000';
    });

    /* Toast fallback */
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');
    function showToast(msg, duration=3500){
      toastMessage.textContent = msg;
      toast.style.display = 'block';
      toast.style.opacity = '1';
      setTimeout(()=>{ toast.style.opacity = '0'; setTimeout(()=> toast.style.display='none', 300); }, duration);
    }

    /* Submit via AJAX (server must return JSON; expected: { link: "https://..." } ) */
    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      // Basic validation
      if (inputType.value === 'text' && (!userText.value || !userText.value.trim())){
        Swal.fire({ icon:'warning', title:'Empty', text:'Please enter some text.' }); return;
      }
      if (inputType.value === 'file' && (!userFile.files || !userFile.files.length)){
        Swal.fire({ icon:'warning', title:'No file', text:'Please choose a file.' }); return;
      }

      const data = new FormData(form);
      Swal.fire({ title:'Sharing...', allowOutsideClick:false, didOpen(){ Swal.showLoading(); } });

      try{
        const res = await fetch(form.action, { method:'POST', body: data });
        const json = await res.json().catch(()=> ({}));
        if (!res.ok) throw new Error(json?.message || res.statusText || 'Server error');

        if (json?.link){
          try { await navigator.clipboard.writeText(json.link); } catch(_) {}
          Swal.fire({ icon:'success', title:'Shared', html: `<div class="text-start">Link copied to clipboard:<div class="mt-2 p-2" style="background:rgba(255,255,255,0.03);border-radius:8px;color:inherit;">${json.link}</div></div>`, width:600 });
          showToast('Shared — link copied to clipboard');
        } else {
          Swal.fire({ icon:'success', title:'Shared', text: json?.message || 'Shared successfully' });
          showToast(json?.message || 'Shared successfully');
        }

        form.reset();
        updateFormAction(false);
        resetDragPreview();
        charCount.textContent = '0 / 10000';
      } catch(err){
        Swal.fire({ icon:'error', title:'Error', text: err.message || 'Something went wrong' });
      }
    });

    // Initialize: reset preview and char count
    resetDragPreview();
    charCount.textContent = `${userText.value.length} / 10000`;
  })();
  </script>
</body>
</html>
